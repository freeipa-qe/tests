#yum -y install ypbind portmap yp-tools nscd autofs
yum -y install ypbind yp-tools nscd

if [ -z "$NISDOMAIN" ]; then
	echo "NISDOMAIN env var not set"
	exit 1
fi

cp /etc/sysconfig/network /etc/sysconfig/network.orig.setup-nis-client
echo "NISDOMAIN=$NISDOMAIN" >> /etc/sysconfig/network

cp /etc/yp.conf /etc/yp.conf.orig.setup-nis-client
echo "domain $NISDOMAIN server $NISMASTER" >> /etc/yp.conf

cp /etc/nsswitch.conf /etc/nsswitch.conf.orig.setup-nis-client
sed -i 's/^passwd:.*$/passwd: files nis/' /etc/nsswitch.conf
sed -i 's/^shadow:.*$/shadow: files nis/' /etc/nsswitch.conf
sed -i 's/^group:.*$/group:  files nis/' /etc/nsswitch.conf

nisdomainname $NISDOMAIN

service portmap restart
service ypbind start
service nscd start

