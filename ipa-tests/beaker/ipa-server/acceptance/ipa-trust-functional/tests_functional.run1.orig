### 01.)Trusted AD user ssh to IPA Server 	

Is this one supposed to be from Windows client to IPA server or just can AD user ssh to IPA client?

I'm assuming the latter here:

[root@rhel6-1 ~]# vi /etc/krb5.conf
...
[realms]
 TESTRELM.COM = {
...
  auth_to_local = RULE:[1:$1@$0](^.*@ADTESTDOM.COM$)s/@ADTESTDOM.COM/@adtestdom.com/
  auth_to_local = DEFAULT
}

[root@rhel6-1 ~]# vi /etc/sssd/sssd.conf
...
[domain/ipa.lan]
...
subdomains_provider = ipa
...
[sssd]
services = nss, pam, ssh, pac

[root@rhel6-1 ~]# service sssd restart
Stopping sssd:                                             [  OK  ]
Starting sssd:                                             [  OK  ]

[root@rhel6-1 samba]# ipa group-add --desc='adtestdom.com Domain users external map' adtestdom_domain_users_external --external
---------------------------------------------
Added group "adtestdom_domain_users_external"
---------------------------------------------
  Group name: adtestdom_domain_users_external
  Description: adtestdom.com Domain users external map

[root@rhel6-1 samba]# ipa group-add --desc='adtestdom.com Domain users' adtestdom_domain_users
------------------------------------
Added group "adtestdom_domain_users"
------------------------------------
  Group name: adtestdom_domain_users
  Description: adtestdom.com Domain users
  GID: 1277200028

Here I ran into a problem where wbinfo returned:
[root@rhel6-1 ~]# wbinfo --online-status
BUILTIN : online
TESTRELM : online
ADTESTDOM : offline
AD2TESTDOM : offline

[root@rhel6-1 ~]# wbinfo -n "ADTESTDOM\Domain Users"
failed to call wbcLookupName: WBC_ERR_DOMAIN_NOT_FOUND
Could not lookup name ADTESTDOM\Domain Users

After some troubleshooting and rebooting AD server, I found that the time was off on the AD server and saw this error in messages:

Oct 22 17:43:05 rhel6-1 winbindd[12089]:   kerberos_kinit_password TESTRELM@ADTESTDOM.COM failed: Ticket is ineligible for postdating

Fixed time on AD server.  I think that fixed it.  wbinfo --online status still showed offline but, the
rest seemed to work:

[root@rhel6-1 samba]# wbinfo -n "ADTESTDOM\Domain Users"
S-1-5-21-1246088475-3077293710-2580964704-513 SID_DOM_GROUP (2)

[root@rhel6-1 samba]# ipa group-add-member adtestdom_domain_users_external --external S-1-5-21-1246088475-3077293710-2580964704-513
[member user]: 
[member group]: 
  Group name: adtestdom_domain_users_external
  Description: adtestdom.com Domain users external map
  External member: S-1-5-21-1246088475-3077293710-2580964704-513
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 samba]# ipa group-add-member adtestdom_domain_users --groups adtestdom_domain_users_external
  Group name: adtestdom_domain_users
  Description: adtestdom.com Domain users
  GID: 1277200028
  Member groups: adtestdom_domain_users_external
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 yum.local.d]# kinit admin
Password for admin@TESTRELM.COM: 

[root@rhel6-1 yum.local.d]# kinit testuser1@ADTESTDOM.COM
Password for testuser1@ADTESTDOM.COM: 

[root@rhel6-1 yum.local.d]# id
uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

[root@rhel6-1 yum.local.d]# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: testuser1@ADTESTDOM.COM

Valid starting     Expires            Service principal
10/23/12 12:28:31  10/23/12 22:28:22  krbtgt/ADTESTDOM.COM@ADTESTDOM.COM
	renew until 10/24/12 12:28:31

[root@rhel6-1 yum.local.d]# ssh -K -l testuser1@adtestdom.com rhel6-1
Last login: Tue Oct 23 12:28:04 2012 from rhel6-1.testrelm.com

-sh-4.1$ whoami
testuser1@adtestdom.com

-sh-4.1$ id
uid=1232801127(testuser1@adtestdom.com) gid=1232801127(testuser1@adtestdom.com) groups=1232801127(testuser1@adtestdom.com),1277200028(adtestdom_domain_users) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

I haven't checked yet, but, is this necessary on every IPA client?  Or just on the IPA servers? 

### 02.) ssh as windows user locally after authenticating into windows client

I'm not quite sure of what this one means?  ssh from windows client to ipa client?  Or is it 
something like this?

- log into windows client as testuser
- log into ipa client as testuser
- kinit testuser@addomain
- ssh localhost 

### 03.) ssh and test linux cmds from windows client

Using Putty on w2k8r2-1 seemed to work.

Able to log in with Administrator@adtestdom.com user name, and run id and whoami

### 04.) Add hbac rule for user and try ssh

On AD side, create testgroup with testuser1 as member.

[root@rhel6-1 ~]# ipa group-add --desc='adtestdom.com testgroup external map' adtestdom_testgroup_external --external
------------------------------------------
Added group "adtestdom_testgroup_external"
------------------------------------------
  Group name: adtestdom_testgroup_external
  Description: adtestdom.com testgroup external map

[root@rhel6-1 ~]# ipa group-add --desc='adtestdom.com testgroup' adtestdom_testgroup
---------------------------------
Added group "adtestdom_testgroup"
---------------------------------
  Group name: adtestdom_testgroup
  Description: adtestdom.com testgroup
  GID: 1277200031

[root@rhel6-1 ~]# wbinfo -n "ADTESTDOM\testuser1"
S-1-5-21-1246088475-3077293710-2580964704-1127 SID_USER (1)

[root@rhel6-1 ~]# wbinfo -n "ADTESTDOM\testgroup"
S-1-5-21-1246088475-3077293710-2580964704-1132 SID_DOM_GROUP (2)

[root@rhel6-1 ~]# ipa group-add-member adtestdom_testgroup_external --external S-1-5-21-1246088475-3077293710-2580964704-1132
[member user]: 
[member group]: 
  Group name: adtestdom_testgroup_external
  Description: adtestdom.com testgroup external map
  External member: S-1-5-21-1246088475-3077293710-2580964704-1132
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 tmp]# ipa hbacrule-add --desc=test test
----------------------
Added HBAC rule "test"
----------------------
  Rule name: test
  Description: test
  Enabled: TRUE

[root@rhel6-1 tmp]# ipa hbacrule-add-host --hosts=rhel6-1.testrelm.com test
  Rule name: test
  Description: test
  Enabled: TRUE
  Hosts: rhel6-1.testrelm.com
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 tmp]# ipa hbacrule-add-sourcehost test --hosts=w2k8r2-3.adtestdom.com 
  Rule name: test
  Description: test
  Enabled: TRUE
  Hosts: rhel6-1.testrelm.com
  External host: w2k8r2-3.adtestdom.com
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 tmp]# ipa hbacsvc-add ssh
------------------------
Added HBAC service "ssh"
------------------------
  Service name: ssh

[root@rhel6-1 tmp]# ipa hbacrule-add-service --hbacsvcs=sshd  test
  Rule name: test
  Description: test
  Enabled: TRUE
  Hosts: rhel6-1.testrelm.com
  Services: sshd
  External host: w2k8r2-3.adtestdom.com
-------------------------
Number of members added 1
-------------------------

here we use the previously setup ADTESTDOM\Domain Users group adtestdom_domain_users:

[root@rhel6-1 tmp]# ipa hbacrule-add-user test --groups=adtestdom_domain_users
  Rule name: test
  Description: test
  Enabled: TRUE
  User Groups: adtestdom_domain_users
  Hosts: rhel6-1.testrelm.com
  Services: sshd
  External host: w2k8r2-3.adtestdom.com
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 ~]# ipa hbacrule-remove-user --groups=adtestdom_domain_users
Rule name: test
  Rule name: test
  Description: test
  Enabled: TRUE
  Hosts: rhel6-1.testrelm.com
  Services: sshd
  External host: w2k8r2-3.adtestdom.com
---------------------------
Number of members removed 1
---------------------------

[root@rhel6-1 ~]# ipa hbacrule-add-user --groups=adtestdom_testgroup
Rule name: test
  Rule name: test
  Description: test
  Enabled: TRUE
  User Groups: adtestdom_testgroup
  Hosts: rhel6-1.testrelm.com
  Services: sshd
  External host: w2k8r2-3.adtestdom.com
-------------------------
Number of members added 1
-------------------------

[root@rhel6-1 ~]# kinit testuser1@ADTESTDOM.COM
Password for testuser1@ADTESTDOM.COM: 

[root@rhel6-1 ~]# !ssh
ssh -l testuser1@adtestdom.com rhel6-1.testrelm.com
Connection closed by UNKNOWN

[root@rhel6-1 ~]# ssh -K -l testuser1@adtestdom.com rhel6-1.testrelm.com
Connection closed by UNKNOWN

Ok, this fails to work.  Opened BZ after some troubleshooting with jhrozek, sbose, ab, sgallagh:

https://bugzilla.redhat.com/show_bug.cgi?id=869678

### 05.) Modify AD username while ssh to IPA and try linux cmds

Not sure what this one means.  Change the actual username?  like from testuser1 to testuser2?

[root@rhel6-1 ~]# kinit admin
Password for admin@TESTRELM.COM: 

[root@rhel6-1 ~]# ipa hbacrule-enable allow_all
-----------------------------
Enabled HBAC rule "allow_all"
-----------------------------

[root@rhel6-1 ~]# kinit testuser1@ADTESTDOM.COM
Password for testuser1@ADTESTDOM.COM: 

[root@rhel6-1 ~]# ssh -k -l testuser1@adtestdom.com rhel6-1
Last login: Wed Oct 24 11:13:24 2012 from rhel6-1.testrelm.com
id: cannot find name for group ID 1232801127

-sh-4.1$ hostname
rhel6-1.testrelm.com

-sh-4.1$ id
uid=1232801127(testuser1@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ whoami
testuser1@adtestdom.com

-sh-4.1$ id
uid=1232801127(testuser1@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ whoami
testuser1@adtestdom.com

-sh-4.1$ 

Now, on AD side, change testuser1 to testuser1new because testuser2 is already used.

Then on a different IPA Replica (need a different window) I did this:

[root@rhel6-2 ~]# kinit testuser1@ADTESTDOM.COM
kinit: Client not found in Kerberos database while getting initial credentials

[root@rhel6-2 ~]# kinit testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-2 ~]# ssh -K -l testuser1new@ADTESTDOM.COM rhel6-1.testrelm.com
testuser1new@ADTESTDOM.COM@rhel6-1.testrelm.com's password: 
Creating home directory for testuser1new@ADTESTDOM.COM.
Last login: Wed Oct 24 13:30:07 2012 from rhel6-1.testrelm.com
id: cannot find name for group ID 1232801127

-sh-4.1$ pwd
/home/adtestdom.com/testuser1new

-sh-4.1$ id
uid=1232801127(testuser1@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ whoami
testuser1@adtestdom.com


Should the id/whoami info stayed the same?  SSSD caching?

### 06.) Modify AD user passwd while connected through ssh and try linux cmds

Should I be expecting something to prompt me even though I'm already logged in?

Following from the previous test, on AD, reset password for testuser1new.

I see the following after the password reset but, I don't know if that's a cause or just 
a timing issue with SSSD maybe?

-sh-4.1$ id
uid=1232801127 gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ whoami
whoami: cannot find name for user ID 1232801127

-sh-4.1$ exit
logout
Connection to rhel6-1 closed.

[root@rhel6-1 ~]# ssh -k -l testuser1@adtestdom.com rhel6-1
testuser1@adtestdom.com@rhel6-1's password: 
Permission denied, please try again.
testuser1@adtestdom.com@rhel6-1's password: 
Received disconnect from UNKNOWN: 2: Too many authentication failures for testuser1@adtestdom.com

[root@rhel6-1 ~]# kinit testuser1new
kinit: Client 'testuser1new@TESTRELM.COM' not found in Kerberos database while getting initial credentials

[root@rhel6-1 ~]# kinit testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-1 ~]# kinit admin
Password for admin@TESTRELM.COM: 

[root@rhel6-1 ~]# ssh -l testuser1new@adtestdom.com rhel6-1
testuser1new@adtestdom.com@rhel6-1's password: 
Write failed: Broken pipe

[root@rhel6-1 ~]# kinit  testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-1 ~]# ssh -K -l testuser1new@adtestdom.com rhel6-1
Write failed: Broken pipe

[root@rhel6-1 ~]# less /var/log/secure

So, I go ahead and clear the sssd cache to try to test login with new password.

[root@rhel6-1 ~]# service sssd stop
Stopping sssd:                                             [  OK  ]

[root@rhel6-1 ~]#  mkdir /var/lib/sss/db/backup1

[root@rhel6-1 ~]# mv /var/lib/sss/db/* /var/lib/sss/db/backup1
mv: cannot move `/var/lib/sss/db/backup1' to a subdirectory of itself, `/var/lib/sss/db/backup1/backup1'
[root@rhel6-1 ~]# service sssd start
Starting sssd:                                             [  OK  ]

[root@rhel6-1 ~]# kinit  testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-1 ~]# ssh -K -l testuser1new@adtestdom.com rhel6-1
Last login: Wed Oct 24 13:31:27 2012 from rhel6-2.testrelm.com
id: cannot find name for group ID 1232801127

-sh-4.1$ id
uid=1232801127(testuser1new@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ whoami
testuser1new@adtestdom.com

-sh-4.1$ touch one
-sh-4.1$ ls -ld one
-rw-r--r--. 1 testuser1new@adtestdom.com 1232801127 0 Oct 24 13:40 one

### 07.) Trusted AD user ssh to IPA Replica

-sh-4.1$ ssh -K -l testuser1new@adtestdom.com rhel6-2.testrelm.com
You don't exist, go away!


On Replica:
[root@rhel6-2 ~]# vi /etc/sssd/sssd.conf 
...
[domain/testrelm.com]
...
subdomains_provider = ipa
...
[sssd]
services = nss, pam, ssh, pac
...

[root@rhel6-2 ~]# vi /etc/krb5.conf
...
[realms]
 TESTRELM.COM = {
  kdc = rhel6-2.testrelm.com:88
  master_kdc = rhel6-2.testrelm.com:88
  admin_server = rhel6-2.testrelm.com:749
  default_domain = testrelm.com
  pkinit_anchors = FILE:/etc/ipa/ca.crt
  auth_to_local = RULE:[1:$1@$0](^.*@ADTESTDOM.COM$)s/@ADTESTDOM.COM/@adtestdom.com/
  auth_to_local = DEFAULT
}
...

[root@rhel6-2 ~]# service sssd restart
Stopping sssd:                                             [  OK  ]
Starting sssd:                                             [  OK  ]

[root@rhel6-2 ~]# service krb5kdc restart
Stopping Kerberos 5 KDC:                                   [  OK  ]
Starting Kerberos 5 KDC:                                   [  OK  ]

[root@rhel6-2 ~]# service httpd restart
Stopping httpd:                                            [  OK  ]
Starting httpd:                                            [  OK  ]

[root@rhel6-2 ~]# service named restart
Stopping named: .                                          [  OK  ]
Starting named:                                            [  OK  ]

[root@rhel6-2 ~]# service sssd stop
Stopping sssd:                                             [  OK  ]

[root@rhel6-2 ~]# rm -f /var/lib/sss/db/*

[root@rhel6-2 ~]# service sssd start
Starting sssd:                                             [  OK  ]

So, I do kinit on replica to see that the user can be seen by krb at least:

[root@rhel6-2 ~]# kinit testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-2 ~]# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: testuser1new@ADTESTDOM.COM

Valid starting     Expires            Service principal
10/24/12 13:50:18  10/24/12 23:50:05  krbtgt/ADTESTDOM.COM@ADTESTDOM.COM
	renew until 10/25/12 13:50:18

[root@rhel6-2 ~]# ssh -K -l testuser1new@adtestdom.com rhel6-2.testrelm.com
testuser1new@adtestdom.com@rhel6-2.testrelm.com's password: 
Permission denied, please try again.
testuser1new@adtestdom.com@rhel6-2.testrelm.com's password: 
Received disconnect from UNKNOWN: 2: Too many authentication failures for testuser1new@adtestdom.com

Do I have to run ipa-adtrust-install or something else on the Replica?

Seems like I do have to do that...

[root@rhel6-2 etc]# yum install ipa-server-trust-ad
...
Complete!

[root@rhel6-2 etc]# ipa-adtrust-install 

The log file for this installation can be found in /var/log/ipaserver-install.log
==============================================================================
This program will setup components needed to establish trust to AD domains for
the FreeIPA Server.

This includes:
  * Configure Samba
  * Add trust related objects to FreeIPA LDAP server

To accept the default shown in brackets, press the Enter key.


The following operations may take some minutes to complete.
Please wait until the prompt is returned.

Enter the NetBIOS name for the IPA domain.
Only up to 15 uppercase ASCII letters and digits are allowed.
Example: EXAMPLE.


NetBIOS domain name [TESTRELM]: 

Configuring cross-realm trusts for IPA server requires password for user 'admin'.
This user is a regular system account used for IPA server administration.

admin password: 

Configuring CIFS:
  [1/18]: stopping smbd
  [2/18]: creating samba domain object
  [3/18]: creating samba config registry
  [4/18]: writing samba config file
  [5/18]: adding cifs Kerberos principal
  [6/18]: adding cifs principal to S4U2Proxy targets
  [7/18]: adding admin(group) SIDs
Admin SID already set, nothing to do
Admin group SID already set, nothing to do
  [8/18]: adding RID bases
RID bases already set, nothing to do
  [9/18]: updating Kerberos config
'dns_lookup_kdc' already set to 'true', nothing to do.
  [10/18]: activating CLDAP plugin
  [11/18]: activating sidgen plugin and task
  [12/18]: activating extdom plugin
  [13/18]: configuring smbd to start on boot
  [14/18]: adding special DNS service records
  [15/18]: restarting Directory Server to take MS PAC and LDAP plugins changes into account
  [16/18]: adding fallback group
Fallback group already set, nothing to do
  [17/18]: setting SELinux booleans
  [18/18]: starting CIFS services
done configuring smb.

=============================================================================
Setup complete

You must make sure these network ports are open:
	TCP Ports:
	  * 138: netbios-dgm
	  * 139: netbios-ssn
	  * 445: microsoft-ds
	UDP Ports:
	  * 138: netbios-dgm
	  * 139: netbios-ssn
	  * 389: (C)LDAP
	  * 445: microsoft-ds

Additionally you have to make sure the FreeIPA LDAP server is not reachable
by any domain controller in the Active Directory domain by closing down
the following ports for these servers:
	TCP Ports:
	  * 389, 636: LDAP/LDAPS

You may want to choose to REJECT the network packets instead of DROPing
them to avoid timeouts on the AD domain controllers.

=============================================================================

[root@rhel6-2 etc]# service krb5kdc restart
Stopping Kerberos 5 KDC:                                   [  OK  ]
Starting Kerberos 5 KDC:                                   [  OK  ]

[root@rhel6-2 etc]# service httpd restart
Stopping httpd:                                            [  OK  ]
Starting httpd:                                            [  OK  ]

[root@rhel6-2 etc]# service sssd restart
Stopping sssd:                                             [  OK  ]
Starting sssd:                                             [  OK  ]

[root@rhel6-2 etc]# kinit testuser1new@ADTESTDOM.COM
Password for testuser1new@ADTESTDOM.COM: 

[root@rhel6-2 etc]# ssh -K -l testuser1new@adtestdom.com rhel6-2.testrelm.com
Could not chdir to home directory /home/adtestdom.com/testuser1new: No such file or directory
id: cannot find name for group ID 1232801127

-sh-4.1$ 

Ok, is it mentioned somewhere that must be done on all IPA servers even for client side to work?

Or, is there another way to get the client to work without having to do that?

### 08.) Trusted AD user ssh to IPA Client

[root@rhel6-3 ~]# vi /etc/sssd/sssd.conf
...
[domain/testrelm.com]
...
subdomains_provider = ipa
...
[sssd]
services = nss, pam, ssh, pac
...

[root@rhel6-3 ~]# vi /etc/krb5.conf
...
[libdefaults]
...
  dns_lookup_kdc = true
...
[realms]
  TESTRELM.COM = {
...
    auth_to_local = RULE:[1:$1@$0](^.*@ADTESTDOM.COM$)s/@ADTESTDOM.COM/@adtestdom.com/
    auth_to_local = DEFAULT
  }
...

[root@rhel6-3 ~]# service sssd restart
Stopping sssd:                                             [  OK  ]
Starting sssd:                                             [  OK  ]

[root@rhel6-3 ~]# ssh -K -l testuser1new@adtestdom.com rhel6-3.testrelm.com
Could not chdir to home directory /home/adtestdom.com/testuser1new: No such file or directory
id: cannot find name for group ID 1232801127

-sh-4.1$ 

So that one seemed to work without a hitch.  

### 09.) Trusted User modifies passwd and then ssh

-sh-4.1$ id
uid=1232801127(testuser1new@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ passwd
Changing password for user testuser1new@adtestdom.com.
Current Password: 
passwd: Authentication token manipulation error

Ok, I tried this from w2k8r2-3 (AD client) but, I can't seem to change it there either.

How can I change password as the user itself?

### 10.) AD user ssh logged in and detele trust

What should I see here?  Should the user be allowed to continue functioning?  
Or is this more of the kind of thing where it won't take affect until log out and back in?

on rhel6-2 before deleting trust:

-sh-4.1$ id
uid=1232801127(testuser1new@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

deleting trust on rhel6-1:
[root@rhel6-1 ~]# ipa trust-del adtestdom.com
-----------------------------
Deleted trust "adtestdom.com"
-----------------------------
[root@rhel6-1 ~]# date
Wed Oct 24 15:21:12 EDT 2012

on rhel6-2 after deleting trust:

-sh-4.1$ id
uid=1232801127(testuser1new@adtestdom.com) gid=1232801127 groups=1232801127,1277200028(adtestdom_domain_users),1277200031(adtestdom_testgroup) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023

-sh-4.1$ klist
Ticket cache: FILE:/tmp/krb5cc_1232801127_CTaNaVc805
Default principal: testuser1new@ADTESTDOM.COM

Valid starting     Expires            Service principal
10/24/12 15:19:22  10/25/12 01:19:04  krbtgt/ADTESTDOM.COM@ADTESTDOM.COM
	renew until 10/25/12 15:19:18

-sh-4.1$ date
Wed Oct 24 15:21:13 EDT 2012

From another server:

[root@rhel6-3 ~]# ssh -K -l testuser1new@adtestdom.com rhel6-3.testrelm.com
testuser1new@adtestdom.com@rhel6-3.testrelm.com's password: 
Permission denied, please try again.
testuser1new@adtestdom.com@rhel6-3.testrelm.com's password: 

After that though, I can no longer log back in.  So, expected behavior I think?

### 11.) AD user mount NFS share on windows client

Is this supported?  Does windows support NFS natively?  Or should this be CIFS?

[root@rhel6-1 log]# net conf addshare test /tmp
[root@rhel6-1 log]# net conf setparm test 'read only' 'no'
[root@rhel6-1 log]# wbinfo -n "ADTESTDOM\administrator"
S-1-5-21-1246088475-3077293710-2580964704-500 SID_USER (1)
[root@rhel6-1 log]# net conf setparm test 'valid users'  S-1-5-21-1246088475-3077293710-2580964704-500
[root@rhel6-1 log]# net conf list
[global]
	workgroup = TESTRELM
	realm = TESTRELM.COM
	kerberos method = dedicated keytab
	dedicated keytab file = FILE:/etc/samba/samba.keytab
	create krb5 conf = no
	security = user
	domain master = yes
	domain logons = yes
	log level = 1
	max log size = 100000
	log file = /var/log/samba/log.%m
	passdb backend = ipasam:ldapi://%2fvar%2frun%2fslapd-TESTRELM-COM.socket
	disable spoolss = yes
	ldapsam:trusted = yes
	ldap ssl = off
	ldap suffix = dc=testrelm,dc=com
	ldap user suffix = cn=users,cn=accounts
	ldap group suffix = cn=groups,cn=accounts
	ldap machine suffix = cn=computers,cn=accounts
	rpc_server:epmapper = external
	rpc_server:lsarpc = external
	rpc_server:lsass = external
	rpc_server:lsasd = external
	rpc_server:samr = external
	rpc_server:netlogon = external
	rpc_server:tcpip = yes
	rpc_daemon:epmd = fork
	rpc_daemon:lsasd = fork

[test]
	path = /tmp
	guest ok = no
	read only = no
	valid users = S-1-5-21-1246088475-3077293710-2580964704-500

Now, I go to AD server (could have used client but, I just picked a window) and run cmd prompt:

C:\Users\Administrator>net use * \\rhel6-1.testrelm.com\test
Drive Y: is now connected to \\rhel6-1.testrelm.com\test.

The command completed successfully
...

Above typed, not cut and pasted...

### 12.) SSH into an IPA client and mount NFS share

As non-root?  Or is this supposed to be for accessing a CIFS share from AD server?

### 13.) Restrict NFS access to only IPA client IP 
### 14.) Restrict NFS access to only AD user 	
### 15.) Open IPA protected web page from windows client 	
### 16.) Open a vnc connection to the IPA server 	
### 17.) Open a vnc connection to the IPA client 	
### 18.) AD user access IPA website from VNC to IPA server 	
### 19.) AD user access IPA website from VNC to IPA client 	
### 20.) AD user mounts IPA NFS share from VNC to IPA client 	
