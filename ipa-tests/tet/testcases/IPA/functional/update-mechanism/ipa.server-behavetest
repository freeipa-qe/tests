#!/bin/sh

. ./testvars

#ADMIN="admin"
#FirstName="tuser"
#LastName="101"
#USER=$FirstName$LastName
#GROUP="tgroup101"
#PW="redhat123"

echo "ipa server behave test starts"
echo "restart ipa server"
ipactl stop
ipactl start
echo "init as admin, start admin related testing"
echo $PW | kinit $ADMIN
ipa-adduser -c GECOS -d /home/$USER -f $FirstName -l $LastName -p $PW -s /bin/bash $USER
ipa-addgroup -d "test group 101" $GROUP
ipa-modgroup -a $USER $GROUP

ipa-finduser $USER
ipa-findgroup $GROUP

echo "init as regular user, start normal user testing"
kinit  $USER
echo "change the password again"
ipa-passwd $USER

echo "change telephonenumber to 650-123-4567"
ipa-moduser --addattr "telephonenumber=650-123-4567" $USER
ipa-finduser -a $USER | grep "Work Number"
ipa-moduser --delattr "telephonenumber" $USER

echo "init as admin again, continue as admin testing"
echo redhat123 | kinit $ADMIN
ipa-modgroup -r $USER $GROUP

ipa-deluser $USER
ipa-delgroup $GROUP

echo "ipa server behave test done"

