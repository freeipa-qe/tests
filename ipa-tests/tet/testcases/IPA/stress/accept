set -x
# script called by daily build system
# usage : accept Build.tar.gz
H=$0
BUILD=$1
VER=6.0

# figure out where we are
case $H in
	/*|[a-zA-Z]:*)  R=`dirname $H`     ;;
	*)      		R=`pwd`/`dirname $H`   ;;
esac
# R is the source root, before tetframework/...
#R=`echo $R | sed 's:/tetframework/testcases/DS/'$VER'/acceptance:/..:g'`
R=`echo $R | sed 's:/tetframework/testcases/DS/'$VER'/acceptance::g'`

# R=/h/squall/misc/serverqa/release/DS
TESTCASE_ROOT=$R/tetframework/testcases/DS/$VER


# Lakshmi Gopal 04/05/00 removing the temproray mnt 
R=`echo $R | sed 's:/tmp_mnt/:/:g'`
TESTCASE_ROOT=`echo $TESTCASE_ROOT | sed 's:/tmp_mnt/:/:g'`
echo R is $R
echo TESTCASE_ROOT is $TESTCASE_ROOT


if [ $# -lt 1 ]; then
	echo "usage:  accept [complete path of build]"
	exit 1
fi
DRIVE=""
hname=`uname -s`
RSH="rsh"
TESTHOST=""
case $hname in
	SunOS)	
		if [ "$USE_64" = "1" ]; then
			#TESTHOST="works4rh"
			TESTHOST="agamemnon.dsqa.sjc2.redhat.com"
		else
			#TESTHOST="agamemnon"
			TESTHOST="works4rh"
		fi
			;;
	AIX)	#TESTHOST="freeb"
			;;
	OSF1)	#TESTHOST="nitrogen-fix"
			;;
	HP-UX)	TESTHOST="epsilon3.dsqa.sjc2.redhat.com"
			RSH=remsh
			;;
	Windows_NT)	
			TESTHOST="legbreaker"
			DRIVE="t:"
			prefix=/share/builds/habilis
			# hack N: with $prefix, build machine map n: to \\datastore\sbc2
			BUILD=`echo $BUILD | sed 's#[a-zA-Z]:#'${prefix}'#g'`
			TESTCASE_ROOT=`echo $TESTCASE_ROOT | sed 's#[a-zA-Z]:#${prefix}#g'`
			R=`echo $R | sed 's#[a-zA-Z]:#${prefix}#g'`
			;;
	Linux)
			if [ -f /etc/redhat-release ]
			then
				cat /etc/redhat-release | grep -i "release 4" > /dev/null 2>&1
				if [ $? -eq 0 ];
				then
					OS="RHEL4"
				fi
				cat /etc/redhat-release | grep -i "release 5" > /dev/null 2>&1
				if [ $? -eq 0 ];
				then
					OS="RHEL5"
				fi
			fi

			case `uname -p` in
				x86_64)
					if [ "$OS" = "RHEL4" ]
					then
						TESTHOST="nightcrawler.dsqa.sjc2.redhat.com"
					fi
					if [ "$OS" = "RHEL5" ]
					then
						TESTHOST="tigger.dsqa.sjc2.redhat.com"
					fi
					;;
				i386|i686)
					if [ "$OS" = "RHEL4" ]
					then
						TESTHOST="shadowfoot.dsqa.sjc2.redhat.com"
					fi
					if [ "$OS" = "RHEL5" ]
					then
						TESTHOST="marcus.dsqa.sjc2.redhat.com"
					fi
					;;
				*)
					TESTHOST=""
					;;
			esac
			;;
	*)		echo "accept: unknown OS $hname"
			exit 0
			;;
esac

if [ "$TESTHOST" = "" ]; then
	echo no test host assigned for platfrom $hname, exit
	exit 0
fi
echo "testhost: $TESTHOST"
echo "testdir : $R"
echo "drive:    $DRIVE"
echo "build:    $BUILD"


if [ "$TESTHOST" = "" ]; then
	echo var. env. TESTHOST unknown, bye.
	exit 1
fi
echo $RSH $TESTHOST sh ${DRIVE}${TESTCASE_ROOT}/acceptance/launch ${DRIVE}$R ${DRIVE}${BUILD}
$RSH $TESTHOST sh ${DRIVE}${TESTCASE_ROOT}/acceptance/launch ${DRIVE}$R ${DRIVE}${BUILD} &

wait

exit 0
