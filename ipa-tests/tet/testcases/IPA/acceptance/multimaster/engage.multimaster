#ident "%W% %E%"
#
#	File name: run.multimaster
#
#	This file contains the operations specific to the multimaster tests.
#	It is targetted to be included by the main script "run" and not be be 
#	used alone.
#
#	Replace the "xyz" by your name (e.g. "schema") and "Xyz" by your
#	name (e.g. "Schema").
#
#
#	History
# -----------------------------------------------------------------------------
# dd/mm/yy | Author	| Comments
# -----------------------------------------------------------------------------
# 05/15/08 | MGregg     | Creation
# -----------------------------------------------------------------------------

# This function will set the default values for the variables needed.
#
multimaster_default()
{
	if [ -z "$multimasterRunIt" ]
	then
		multimasterRunIt=n
	fi
}

# This function will ask the user for more information/choices if needed.
#
multimaster_ask()
{

	sav_multimasterRunIt=$multimasterRunIt
	echo "    Execute multimaster test suite [$multimasterRunIt] ? \c"
	read rsp
	case $rsp in
		"")	multimasterRunIt=$sav_multimasterRunIt	;;
		y|Y)	
			multimasterRunIt=y
			;;
		*)	multimasterRunIt=n		;;
	esac

}

# This function will print the user's choices (aka variables)
#
multimaster_print()
{
	echo "    Execute multimaster test suite        : $multimasterRunIt"
}

# This function will echo in shell's format the user's choices
# It is the calling function that will redirect the output to
# the saved config file.
#
multimaster_save()
{
	echo "multimasterRunIt=$multimasterRunIt"
}

# This function will check that the test suite may be executed
# It may also perform some kind of pre-configuration of the machine.
# This function should "exit 1" if there is problem.
#
multimaster_check()
{
	kgb=kgb
}

# This function will startup/initiate the test suite
#
multimaster_startup()
{
:
}

# This function will run the test suite
#
multimaster_run()
{
	if [ $multimasterRunIt = n ]
	then
		return
	fi
	echo "multimaster run..."
	echo "Checking to ensure that ipa installed properly"
	eval_vars M1
	ssh root@$FULLHOSTNAME 'ls /ipa-install-failure'
	if [ $? -eq 0 ]; then 
		echo "ERROR! /ipa-install-failure was found on $FULLHOSTNAME. This indicates a install failure. Aborting." >> $MainTmpDir/multimaster.run.out
		echo "FAIL" >> $MainTmpDir/multimaster.run.out
	else
		(
		$TET_ROOT/$MainTccName \
			-e -s $TET_ROOT/testcases/IPA/acceptance/multimaster/tet_scen \
			-x $TET_ROOT/testcases/IPA/tetexecpl.cfg \
			$TET_ROOT/testcases/IPA/acceptance/multimaster \
			multimaster > $MainTmpDir/multimaster.run.out 2>&1
		)&
		EngageTimer $! 1200 120 # wait 1200 sec before kill, then 1200 until kill -9
	fi
	echo ""
	echo "multimaster run $MainTmpDir/multimaster.run.out"
	echo ""
	cat $MainTmpDir/multimaster.run.out
	echo ""
	main_analyze "multimaster run" `grep "tcc: journal file is" $MainTmpDir/multimaster.run.out | awk '{print $5}'` $MainTmpDir/multimaster.run.out
	MainReportFiles="$MainReportFiles $MainTmpDir/multimaster.run.out"

	Gfile="$TET_TMP_DIR/global_src_`uname -n`"
	rm -f $Gfile
}

# This function will cleanup after the test suite execution
#
multimaster_cleanup()
{
:
}


#
# End of file
